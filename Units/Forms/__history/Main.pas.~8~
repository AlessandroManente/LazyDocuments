unit Main;

interface

uses
  ClassDatabaseManager,
  LogIn,
  Winapi.Windows,
  Winapi.Messages,
  System.SysUtils,
  System.Variants,
  System.Classes,
  Vcl.Graphics,
  Vcl.Controls,
  Vcl.Forms,
  Vcl.Dialogs,
  Vcl.ComCtrls,
  Vcl.ExtCtrls,
  Vcl.WinXCtrls,
  System.Actions,
  Vcl.ActnList,
  System.ImageList,
  Vcl.ImgList,
  Vcl.CategoryButtons,
  Vcl.Buttons, FireDAC.Stan.ExprFuncs, FireDAC.Phys.SQLiteWrapper.Stat,
  FireDAC.Phys.SQLiteDef, FireDAC.Stan.Intf, FireDAC.Phys, FireDAC.Phys.SQLite,
  FireDAC.Stan.Option, FireDAC.Stan.Error, FireDAC.UI.Intf, FireDAC.Phys.Intf,
  FireDAC.Stan.Def, FireDAC.Stan.Pool, FireDAC.Stan.Async, FireDAC.VCLUI.Wait,
  Data.DB, FireDAC.Comp.Client, FireDAC.Stan.Param, FireDAC.DatS,
  FireDAC.DApt.Intf, FireDAC.DApt, FireDAC.Comp.DataSet, Vcl.Grids, Vcl.DBGrids;

type
  TLazyDocumentsForm = class(TForm)
    SplitView: TSplitView;
    PageCon: TPageControl;
    ActList: TActionList;
    BtnImpostazioni: TSpeedButton;
    BtnAggiungi: TSpeedButton;
    BtnCerca: TSpeedButton;
    TSCerca: TTabSheet;
    TSAggiungi: TTabSheet;
    TSImpostazioni: TTabSheet;
    ActionPCCerca: TAction;
    ActionPCAggiungi: TAction;
    ActionPCImpostazioni: TAction;
    PCercaBase: TPanel;
    PAggiungiBase: TPanel;
    PImpostazioniBase: TPanel;
    DataSource1: TDataSource;
    FDQuery1: TFDQuery;
    DBGrid1: TDBGrid;
    procedure FormCreate(Sender: TObject);
    procedure ActionPCAggiungiExecute(Sender: TObject);
    procedure ActionPCCercaExecute(Sender: TObject);
    procedure ActionPCImpostazioniExecute(Sender: TObject);
    procedure FormShow(Sender: TObject);
  private
    procedure SetupDaUtente(Utente: Integer);
    procedure SetTSCerca;
    procedure SetTSAggiungi;
    procedure SetTSImpostazioni;
  protected
    procedure ExecQueryCerca(SQL: String);
  public
  end;

var
  LazyDocumentsForm: TLazyDocumentsForm;

implementation

{$R *.dfm}

procedure TLazyDocumentsForm.FormCreate(Sender: TObject);
begin
  inherited;
  SetTSCerca;
end;

procedure TLazyDocumentsForm.SetTSAggiungi;
begin
  PageCon.ActivePage := TSAggiungi;
end;

procedure TLazyDocumentsForm.SetTSCerca;
begin
  PageCon.ActivePage := TSCerca;
end;

procedure TLazyDocumentsForm.SetTSImpostazioni;
begin
  PageCon.ActivePage := TSImpostazioni;
end;

procedure TLazyDocumentsForm.ActionPCAggiungiExecute(Sender: TObject);
begin
  SetTSAggiungi;
end;

procedure TLazyDocumentsForm.ActionPCCercaExecute(Sender: TObject);
begin
  SetTSCerca;
end;

procedure TLazyDocumentsForm.ActionPCImpostazioniExecute(Sender: TObject);
begin
  SetTSImpostazioni;
end;

procedure TLazyDocumentsForm.ExecQueryCerca(SQL: String);
begin
  FDQuery1.Connection := DatabaseManager.Connection;
  FDQuery1.SQL.Text := SQL;
  FDQuery1.Open;
end;

procedure TLazyDocumentsForm.FormShow(Sender: TObject);
var
  Utente: Integer;
begin
  Utente := EffettuaLogin;
  if Utente > 0 then
    begin
      SetupDaUtente(Utente);
      inherited;
    end
  else
    Close;
end;

end.
